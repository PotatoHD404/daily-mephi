export const italic = {
    "0": 20,
    "1": 20,
    "2": 20,
    "3": 20,
    "4": 20,
    "5": 20,
    "6": 20,
    "7": 20,
    "8": 20,
    "9": 20,
    "a": 20,
    "b": 20,
    "c": 17.75,
    "d": 20,
    "e": 17.75,
    "f": 11.11,
    "g": 20,
    "h": 20,
    "i": 11.11,
    "j": 11.11,
    "k": 17.75,
    "l": 11.11,
    "m": 28.89,
    "n": 20,
    "o": 20,
    "p": 20,
    "q": 20,
    "r": 15.57,
    "s": 15.57,
    "t": 11.11,
    "u": 20,
    "v": 17.75,
    "w": 26.68,
    "x": 17.75,
    "y": 17.75,
    "z": 15.57,
    "A": 24.43,
    "B": 24.43,
    "C": 26.68,
    "D": 28.89,
    "E": 24.43,
    "F": 24.43,
    "G": 28.89,
    "H": 28.89,
    "I": 13.32,
    "J": 17.75,
    "K": 26.68,
    "L": 22.25,
    "M": 33.32,
    "N": 26.68,
    "O": 28.89,
    "P": 24.43,
    "Q": 28.89,
    "R": 24.43,
    "S": 20,
    "T": 22.25,
    "U": 28.89,
    "V": 24.43,
    "W": 33.32,
    "X": 24.43,
    "Y": 22.25,
    "Z": 22.25,
    "А": 24.43,
    "Б": 23.59,
    "В": 24.43,
    "Г": 22.75,
    "Д": 25.45,
    "Е": 24.43,
    "Ё": 24.43,
    "Ж": 36.64,
    "З": 19.8,
    "И": 28.89,
    "К": 26.56,
    "Л": 27.09,
    "М": 33.32,
    "Н": 28.89,
    "О": 28.89,
    "П": 28.89,
    "Р": 24.43,
    "С": 26.68,
    "Т": 22.25,
    "У": 26.91,
    "Ф": 32.17,
    "Х": 24.43,
    "Ц": 28.89,
    "Ч": 27.56,
    "Ш": 41.72,
    "Щ": 41.72,
    "Ъ": 27.03,
    "Ы": 34.88,
    "Ь": 23.59,
    "Э": 26.19,
    "Ю": 41.29,
    "Я": 26.29,
    "а": 20,
    "б": 20.12,
    "в": 17.36,
    "г": 15.61,
    "д": 20.23,
    "е": 17.75,
    "ё": 17.75,
    "ж": 37.21,
    "з": 15.61,
    "и": 20,
    "к": 18.71,
    "л": 17.44,
    "м": 25.53,
    "н": 19.84,
    "о": 20,
    "п": 20,
    "р": 20,
    "с": 17.75,
    "т": 28.89,
    "у": 17.75,
    "ф": 28.4,
    "х": 17.75,
    "ц": 20,
    "ч": 19.08,
    "ш": 30.2,
    "щ": 30.2,
    "ъ": 20.76,
    "ы": 27.09,
    "ь": 18.2,
    "э": 17.64,
    "ю": 28.2,
    "я": 18.59,
    ";": 13.32,
    ":": 13.32,
    ",": 10,
    ".": 10,
    "!": 13.32,
    "?": 20,
    "-": 13.32,
    "+": 26.99,
    "*": 20,
    "/": 11.11,
    "(": 13.32,
    ")": 13.32,
    "[": 15.57,
    "]": 15.57,
    "{": 16,
    "}": 16,
    "<": 26.99,
    ">": 26.99,
    "|": 11,
    "\\": 11.11,
    "\"": 16.8,
    "'": 8.55,
    "&": 31.11,
    "%": 33.32,
    "$": 20,
    "#": 20,
    "@": 36.8,
    "^": 16.88,
    "~": 21.64,
    "_": 20,
    "`": 13.32,
    " ": 10
}

export const regular = {
    "0": 26.68,
    "1": 14.8,
    "2": 22.96,
    "3": 22.88,
    "4": 26.76,
    "5": 22.96,
    "6": 24.68,
    "7": 23.92,
    "8": 25.76,
    "9": 24.68,
    "a": 23.92,
    "b": 27.28,
    "c": 22.84,
    "d": 27.28,
    "e": 24.48,
    "f": 14.12,
    "g": 27.6,
    "h": 27.24,
    "i": 11.16,
    "j": 11.36,
    "k": 24.64,
    "l": 11.16,
    "m": 42.28,
    "n": 27.24,
    "o": 25.4,
    "p": 27.28,
    "q": 27.28,
    "r": 16.4,
    "s": 20.04,
    "t": 16.56,
    "u": 27.08,
    "v": 22.36,
    "w": 35.96,
    "x": 22.08,
    "y": 22.36,
    "z": 20.84,
    "A": 29.28,
    "B": 30.28,
    "C": 28.92,
    "D": 33.04,
    "E": 26.8,
    "F": 25.4,
    "G": 30.88,
    "H": 32.48,
    "I": 12.4,
    "J": 20.52,
    "K": 28.76,
    "L": 23.76,
    "M": 38.2,
    "N": 32.48,
    "O": 33.6,
    "P": 28.88,
    "Q": 33.6,
    "R": 29.08,
    "S": 24.84,
    "T": 23.48,
    "U": 31.64,
    "V": 28.48,
    "W": 45.04,
    "X": 26.92,
    "Y": 25.88,
    "Z": 26.28,
    "А": 30.32,
    "Б": 29.24,
    "В": 29.88,
    "Г": 23.12,
    "Д": 32.16,
    "Е": 26.6,
    "Ё": 26.6,
    "Ж": 41.16,
    "З": 25.68,
    "И": 32.92,
    "К": 28.44,
    "Л": 31.6,
    "М": 38.52,
    "Н": 32.8,
    "О": 33.92,
    "П": 32.84,
    "Р": 28.56,
    "С": 28.72,
    "Т": 24.12,
    "У": 27.64,
    "Ф": 37.04,
    "Х": 26.72,
    "Ц": 33.16,
    "Ч": 29.44,
    "Ш": 43.8,
    "Щ": 44.84,
    "Ъ": 33.12,
    "Ы": 39.72,
    "Ь": 28.52,
    "Э": 28.28,
    "Ю": 43.96,
    "Я": 29.24,
    "а": 23.56,
    "б": 26.48,
    "в": 24.56,
    "г": 19.52,
    "д": 26.56,
    "е": 25.12,
    "ё": 25.12,
    "ж": 33.96,
    "з": 21.76,
    "и": 27.76,
    "к": 23.92,
    "л": 25.64,
    "м": 31.92,
    "н": 27.24,
    "о": 25.64,
    "п": 27.08,
    "р": 27.52,
    "с": 22.84,
    "т": 19.72,
    "у": 22.84,
    "ф": 32.2,
    "х": 21.64,
    "ц": 27.6,
    "ч": 24.36,
    "ш": 37.64,
    "щ": 37.64,
    "ъ": 25.56,
    "ы": 32.28,
    "ь": 23,
    "э": 23,
    "ю": 35.04,
    "я": 24.48,
    ";": 9.08,
    ":": 9.08,
    ",": 9.08,
    ".": 9.08,
    "!": 10.72,
    "?": 22.92,
    "-": 15.32,
    "+": 23.28,
    "*": 16,
    "/": 14.08,
    "(": 13.48,
    ")": 13.52,
    "[": 13.32,
    "]": 13.32,
    "{": 14.04,
    "}": 14.04,
    "<": 23.28,
    ">": 23.28,
    "|": 11.96,
    "\\": 14.08,
    "\"": 15.64,
    "'": 8.4,
    "&": 27.44,
    "%": 33.72,
    "$": 24.84,
    "#": 28.12,
    "@": 41.36,
    "^": 23.32,
    "~": 23.28,
    "_": 20,
    "`": 24,
    " ": 10.76
}

// round all above values to 2 decimal places

// function displayTextWidth(text, font) {
//     let canvas = displayTextWidth.canvas || (displayTextWidth.canvas = document.createElement("canvas"));
//     let context = canvas.getContext("2d");
//     context.font = font;
//     let chars = text.split('');
//     let dict = {};
//     for (let i in chars) {
//         dict[chars[i]] = Math.round(context.measureText(chars[i]).width * 100) / 100
//     }
//     console.log(dict);
// }
// displayTextWidth("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZАБВГДЕЁЖЗИКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзиклмнопрстуфхцчшщъыьэюя0123456789;:,.!?-+*/()[]{}<>|\\\"\'&%$#@^~_` ", "30pt montserrat1")

export function getTextWidth(font: { [x: string]: number; }, text: string): number {
    let width = 0;
    for (let i = 0; i < text.length; i++) {
        width += font[text[i]];
    }
    return width;
}


function addDots(line: string, font: { [p: string]: number }, width: number, maxWidth: number,
                 res: { text: string, width: number }[], multiplier: number, dots: boolean) {
    let last4 = line.substring(line.length - 4);
    let last4_width = getTextWidth(font, last4);
    width -= font[" "];

    line = line.substring(0, line.length - 1);
    // remove last 4 symbols if not enough space for "..."
    if (width - last4_width + getTextWidth(font, "...") > maxWidth && dots) {
        line = line.substring(0, line.length - 4);
        width -= last4_width;

    }
    if (dots) {
        line += "...";
        width += getTextWidth(font, "...");
        width += font[" "];
    }
    if (res.length == 0)
        res.push({text: line, width: width});
    res[res.length - 1] = {text: line, width: width};
    res = res.map(({text, width}) => ({
        text, width: Math.round((width - font[" "]) * multiplier)
    }));
    return res;
}

export function getWrappedText(font: { [x: string]: number; }, text: string, maxWidth: number, maxLines: number, multiplier: number): { text: string, width: number }[] {
    maxLines+= 1;
    const res: { text: string, width: number }[] = [];
    let width = 0;
    let lines = text.replace("\r\n", "\n").split("\n");
    let line_count = 0;
    let line = "";

    maxWidth = maxWidth / multiplier;
    for (let i = 0; i < lines.length; i++) {
        line = "";
        let words = lines[i].split(" ").reverse();

        while (words.length > 0) {
            let word = words.pop();
            if (word === undefined) {
                break;
            }
            let word_width = getTextWidth(font, word);

            if (width + word_width > maxWidth) {
                // console.log(line, line_count)
                line_count++;
                // console.log(line, line_count)
                if (line_count >= maxLines) {
                    return addDots(line, font, width, maxWidth, res, multiplier, (words.length + lines.length - 1 - i) > 0);
                }
                res.push({text: line, width});
                line = "";
                width = 0;
            }
            line += word + " ";
            width += word_width + font[" "];
        }

        line_count++;
        if (line_count >= maxLines) {
            return addDots(line, font, width, maxWidth, res, multiplier, (lines.length - 1 - i) > 0);
        }
        if (i != lines.length - 1)
            width = 0;
    }

    return addDots(line, font, width, maxWidth, res, multiplier, false);
}
